<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PasitDev OCR</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- AOS (Animate On Scroll) CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* Custom font for Thai */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
        }
        /* Style for particles.js background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: #1a202c;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 50% 50%;
            z-index: -1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Particles.js Container -->
    <div id="particles-js"></div>

    <div class="container mx-auto px-4 py-12 flex flex-col items-center justify-center min-h-screen">
        
        <div data-aos="fade-down" class="w-full max-w-3xl bg-gray-800 bg-opacity-80 backdrop-blur-md p-8 rounded-2xl shadow-2xl border border-gray-700">
            <h1 class="text-4xl font-bold text-center mb-2 text-cyan-400">PasitDev OCR</h1>
            <p class="text-center text-gray-400 mb-8">แปลงไฟล์ PDF และรูปภาพเป็นข้อความด้วย AI</p>

            <div data-aos="fade-up" data-aos-delay="200" class="upload-area bg-gray-900 border-2 border-dashed border-gray-600 p-8 rounded-lg text-center cursor-pointer hover:border-cyan-400 hover:bg-gray-800 transition-all duration-300">
                <input type="file" id="file-input" class="hidden" accept=".pdf,.png,.jpg,.jpeg,.bmp,.gif,.tiff">
                <label for="file-input" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-gray-500" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="mt-2 text-sm text-gray-400"><span class="font-semibold text-cyan-500">คลิกเพื่ออัปโหลด</span> หรือลากไฟล์มาวาง</p>
                    <p id="file-name" class="mt-1 text-xs text-gray-500"></p>
                </label>
            </div>
            
            <div data-aos="fade-up" data-aos-delay="300" class="text-center mt-6">
                <button id="upload-btn" class="bg-cyan-600 text-white font-bold py-3 px-8 rounded-full hover:bg-cyan-700 focus:outline-none focus:ring-4 focus:ring-cyan-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:scale-100">
                    แปลงเป็นข้อความ
                </button>
            </div>
        </div>

        <div id="loader" class="text-center mt-8 text-lg text-gray-400 hidden">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-cyan-400 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            กำลังประมวลผล...
        </div>

        <div id="result-container" data-aos="fade-up" data-aos-delay="100" class="w-full max-w-3xl mt-8 hidden">
             <div class="bg-gray-800 bg-opacity-80 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-gray-700">
                <h2 class="text-2xl font-bold mb-4 text-cyan-400">ผลลัพธ์:</h2>
                <button id="export-btn" class="ml-4 bg-green-600 text-white font-bold py-2 px-6 rounded-full hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:scale-100 hidden">
                    ส่งออกเป็นข้อความ (.txt)
                </button>

                <pre id="result-text" class="bg-gray-900 p-4 rounded-lg text-gray-300 whitespace-pre-wrap font-mono text-sm leading-relaxed"></pre>
             </div>
        </div>

    </div>

    <footer class="w-full text-center py-6 text-gray-500 text-sm">
        &copy; 2025 PasitDev. All rights reserved.
    </footer>

    <!-- Particles.js -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <!-- AOS (Animate On Scroll) JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
        });

        // Initialize Particles.js
        particlesJS('particles-js', {
            "particles": {
                "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": "#ffffff" },
                "shape": { "type": "circle", "stroke": { "width": 0, "color": "#000000" }, "polygon": { "nb_sides": 5 } },
                "opacity": { "value": 0.5, "random": true, "anim": { "enable": false, "speed": 1, "opacity_min": 0.1, "sync": false } },
                "size": { "value": 3, "random": true, "anim": { "enable": false, "speed": 40, "size_min": 0.1, "sync": false } },
                "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 },
                "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false, "attract": { "enable": false, "rotateX": 600, "rotateY": 1200 } }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": { "onhover": { "enable": true, "mode": "repulse" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                "modes": { "grab": { "distance": 400, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 400, "size": 40, "duration": 2, "opacity": 8, "speed": 3 }, "repulse": { "distance": 200, "duration": 0.4 }, "push": { "particles_nb": 4 }, "remove": { "particles_nb": 2 } }
            },
            "retina_detect": true
        });
        
        // App Logic
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const resultText = document.getElementById('result-text');
        const loader = document.getElementById('loader');
        const fileNameDisplay = document.getElementById('file-name');
        const resultContainer = document.getElementById('result-container');
        const exportBtn = document.getElementById('export-btn'); // Get reference to the export button

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;
            } else {
                fileNameDisplay.textContent = '';
            }
        });

        uploadBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                alert('กรุณาเลือกไฟล์ก่อนครับ');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            loader.classList.remove('hidden');
            uploadBtn.disabled = true;
            exportBtn.classList.add('hidden'); // Hide export button initially
            resultContainer.classList.add('hidden');
            resultText.textContent = '';

            try {
                const response = await fetch('/ocr', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();
                
                resultContainer.classList.remove('hidden');

                if (response.ok) {
                    resultText.textContent = data.text || 'ไม่พบข้อความในไฟล์';
                    if (data.text) {
                        exportBtn.classList.remove('hidden'); // Show export button if text is available
                    }
                } else {
                    resultText.textContent = `เกิดข้อผิดพลาด: ${data.error || 'ไม่สามารถติดต่อเซิร์ฟเวอร์ได้'}`;
                }
            } catch (error) {
                resultContainer.classList.remove('hidden');
                resultText.textContent = `เกิดข้อผิดพลาดร้ายแรง: ${error.message}`;
            } finally {
                loader.classList.add('hidden');
                uploadBtn.disabled = false;
            }
        });

        exportBtn.addEventListener('click', () => {
            const textToExport = resultText.textContent;
            if (!textToExport || textToExport === 'ไม่พบข้อความในไฟล์') {
                alert('ไม่มีข้อความให้ส่งออก');
                return;
            }

            const blob = new Blob([textToExport], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ocr_result.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>